---
# build and install apr-devel
- name: aprのビルドに必要なパッケージをインストール
  become: yes
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - libuuid-devel

- name: aprのソースファイルをダウンロード
  become: yes
  get_url:
    url: "{{ apr.url }}"
    dest: "{{ apache_2_4.work_dir }}"

- name: aprのパッケージ化(rpm)
  shell: "rpmbuild -ta --clean {{ apr.src_filename }}"
  become: yes
  args:
    chdir: "{{ apache_2_4.work_dir }}"
    creates: "{{ apr.rpm_directory }}/{{ apr.rpm_filenames.1 }}"

- name: aprパッケージ配置用ディレクトリ作成
  become: yes
  file:
    path: "{{ apr.rpm_directory }}"
    state: directory
    owner: root
    group: root
    mode: 0755

- name: aprのパッケージ配置
  become: yes
  shell: "find {{ apache_2_4.rpmbuild_dir }} -name '*.rpm' | xargs -i mv {} ."
  args:
    chdir: "{{ apr.rpm_directory }}"
    creates: "{{ apr.rpm_directory }}/{{ apr.rpm_filenames.1 }}"

- name: apr-develのインストール
  become: yes
  yum:
    name: "{{ apr.rpm_directory }}/{{ item }}"
    state: present
  with_items: "{{ apr.rpm_filenames }}"
